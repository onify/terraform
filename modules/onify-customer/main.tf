module "helix" {
  count      = var.helix ? 1 : 0
  source     = "./helix"
  depends_on = [kubernetes_namespace.customer_namespace,kubernetes_secret.docker-onify]

  kubernetes_node_api_worker    = var.kubernetes_node_api_worker
  helix                         = var.helix
  vanilla                       = var.vanilla
  ghcr_registry_password        = var.ghcr_registry_password
  ghcr_registry_username        = var.ghcr_registry_username
  onify-worker_tls              = var.onify-worker_tls
  onify-agent_tls               = var.onify-agent_tls
  onify-api_tls                 = var.onify-api_tls
  onify-app_tls                 = var.onify-app_tls
  custom_hostname               = var.custom_hostname
  elasticsearch_external        = var.elasticsearch_external
  tls                           = var.tls
  deployment_replicas           = var.deployment_replicas
  gcr_registry_keyfile          = var.gcr_registry_keyfile
  onify-functions_image         = var.onify-functions_image
  onify-helix_image             = var.onify-helix_image
  onify-app_image               = var.onify-app_image
  onify-agent_image             = var.onify-agent_image
  onify-api_image               = var.onify-api_image
  onify-worker_image            = var.onify-worker_image
  onify-api_external            = var.onify-api_external
  onify-functions_external      = var.onify-functions_external
  onify-agent_external          = var.onify-agent_external
  elasticsearch_address         = var.elasticsearch_address
  elasticsearch_heapsize        = var.elasticsearch_heapsize
  elasticsearch_disksize        = var.elasticsearch_disksize
  elasticsearch_memory_limit    = var.elasticsearch_memory_limit
  elasticsearch_memory_requests = var.elasticsearch_memory_requests
  elasticsearch_version         = var.elasticsearch_version
  onify-api_memory_limit        = var.onify-api_memory_limit
  onify-api_cpu_limit           = var.onify-api_cpu_limit
  onify-api_memory_requests     = var.onify-api_memory_requests
  onify-api_cpu_requests        = var.onify-api_cpu_requests
  onify-agent_memory_limit      = var.onify-agent_memory_limit
  onify-agent_cpu_limit         = var.onify-agent_cpu_limit
  onify-agent_memory_requests   = var.onify-agent_memory_requests
  onify-worker_memory_limit     = var.onify-worker_memory_limit
  onify-worker_cpu_limit        = var.onify-worker_cpu_limit
  onify-worker_memory_requests  = var.onify-worker_memory_requests
  onify-worker_cpu_requests     = var.onify-worker_cpu_requests
  onify-app_memory_limit        = var.onify-app_memory_limit
  onify-app_cpu_limit           = var.onify-app_cpu_limit
  onify-app_memory_requests     = var.onify-app_memory_requests
  onify-app_cpu_requests        = var.onify-app_cpu_requests
  ssl_staging                   = var.ssl_staging
  external-dns-domain           = var.external-dns-domain
  gke                           = var.gke
  onify_agent_envs              = var.onify_agent_envs
  onify_api_envs                = var.onify_api_envs
  onify_app_envs                = var.onify_app_envs
  onify_app_helix_envs          = var.onify_app_helix_envs
  onify_functions_envs          = var.onify_functions_envs

}

module "hub" {
  count      = var.helix ? 0 : 1
  source     = "./hub"
  depends_on = [kubernetes_namespace.customer_namespace,kubernetes_secret.docker-onify]

  kubernetes_node_api_worker    = var.kubernetes_node_api_worker
  helix                         = var.helix
  vanilla                       = var.vanilla
  ghcr_registry_password        = var.ghcr_registry_password
  ghcr_registry_username        = var.ghcr_registry_username
  onify-worker_tls              = var.onify-worker_tls
  onify-agent_tls               = var.onify-agent_tls
  onify-api_tls                 = var.onify-api_tls
  onify-app_tls                 = var.onify-app_tls
  custom_hostname               = var.custom_hostname
  elasticsearch_external        = var.elasticsearch_external
  tls                           = var.tls
  deployment_replicas           = var.deployment_replicas
  gcr_registry_keyfile          = var.gcr_registry_keyfile
  onify-functions_image         = var.onify-functions_image
  onify-helix_image             = var.onify-helix_image
  onify-app_image               = var.onify-app_image
  onify-agent_image             = var.onify-agent_image
  onify-api_image               = var.onify-api_image
  onify-worker_image            = var.onify-worker_image
  onify-api_external            = var.onify-api_external
  onify-functions_external      = var.onify-functions_external
  onify-agent_external          = var.onify-agent_external
  elasticsearch_address         = var.elasticsearch_address
  elasticsearch_heapsize        = var.elasticsearch_heapsize
  elasticsearch_disksize        = var.elasticsearch_disksize
  elasticsearch_memory_limit    = var.elasticsearch_memory_limit
  elasticsearch_memory_requests = var.elasticsearch_memory_requests
  elasticsearch_version         = var.elasticsearch_version
  onify-api_memory_limit        = var.onify-api_memory_limit
  onify-api_cpu_limit           = var.onify-api_cpu_limit
  onify-api_memory_requests     = var.onify-api_memory_requests
  onify-api_cpu_requests        = var.onify-api_cpu_requests
  onify-agent_memory_limit      = var.onify-agent_memory_limit
  onify-agent_cpu_limit         = var.onify-agent_cpu_limit
  onify-agent_memory_requests   = var.onify-agent_memory_requests
  onify-worker_memory_limit     = var.onify-worker_memory_limit
  onify-worker_cpu_limit        = var.onify-worker_cpu_limit
  onify-worker_memory_requests  = var.onify-worker_memory_requests
  onify-worker_cpu_requests     = var.onify-worker_cpu_requests
  onify-app_memory_limit        = var.onify-app_memory_limit
  onify-app_cpu_limit           = var.onify-app_cpu_limit
  onify-app_memory_requests     = var.onify-app_memory_requests
  onify-app_cpu_requests        = var.onify-app_cpu_requests
  ssl_staging                   = var.ssl_staging
  external-dns-domain           = var.external-dns-domain
  gke                           = var.gke
  onify_agent_envs              = var.onify_agent_envs
  onify_api_envs                = var.onify_api_envs
  onify_app_envs                = var.onify_app_envs
  onify_app_helix_envs          = var.onify_app_helix_envs
  onify_functions_envs          = var.onify_functions_envs
}